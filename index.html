<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Bonos de Carbono ‚Äì Proyecto de Ingenier√≠a Econ√≥mica</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Chart.js para el gr√°fico comparativo -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --verde-oscuro: #124734;
      --verde: #1f7a4d;
      --verde-claro: #e5f4ec;
      --crema: #f9f6f0;
      --gris-texto: #444444;
      --gris-claro: #dddddd;
      --rojo: #b00020;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--gris-texto);
      background: linear-gradient(180deg, #f3f7f5 0%, #ffffff 40%, #f3f7f5 100%);
    }

    header {
      background: radial-gradient(circle at top left, #2e8b57, #124734);
      color: white;
      padding: 24px 16px 24px;
    }

    .contenedor {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 16px 40px;
    }

    .header-top {
      display: flex;
      flex-direction: column;
      gap: 16px;
      align-items: flex-start;
    }

    .logo-circulo {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      background: rgba(0,0,0,0.12);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(0,0,0,0.18);
      border-radius: 999px;
      padding: 4px 12px;
      font-size: 12px;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #9be7c4;
    }

    h1 {
      margin: 8px 0 4px;
      font-size: clamp(24px, 4vw, 32px);
    }

    .subtitulo {
      margin: 0;
      max-width: 640px;
      font-size: 14px;
      line-height: 1.5;
      opacity: 0.95;
    }

    .subtitulo-sec {
      margin-top: 6px;
      font-size: 12px;
      opacity: 0.9;
    }

    .chip-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .chip {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.4);
      background: rgba(0,0,0,0.12);
    }

    .header-grid {
      margin-top: 20px;
      display: grid;
      grid-template-columns: minmax(0, 2.2fr) minmax(0, 1.3fr);
      gap: 20px;
      align-items: stretch;
    }

    .resumen-card {
      background: rgba(255,255,255,0.12);
      border-radius: 16px;
      padding: 16px 18px;
      border: 1px solid rgba(255,255,255,0.25);
      display: flex;
      flex-direction: column;
      gap: 10px;
      font-size: 13px;
    }

    .resumen-item {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .resumen-label { opacity: 0.85; }
    .resumen-valor { font-weight: 600; }

    .pill {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.4);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      opacity: 0.9;
    }

    /* Banner para la imagen de Sora */
    .hero-banner {
      margin-top: 18px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.35);
      background: rgba(0,0,0,0.18);
    }

    .hero-banner img {
      display: block;
      width: 100%;
      height: auto;
      max-height: 260px;
      object-fit: cover;
    }

    main {
      margin-top: 0;
    }

    .layout-principal {
      display: grid;
      grid-template-columns: minmax(0, 1.65fr) minmax(0, 1.35fr);
      gap: 24px;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .header-grid,
      .layout-principal {
        grid-template-columns: 1fr;
      }
    }

    section { margin-top: 24px; }

    h2 {
      font-size: 18px;
      margin: 0 0 8px;
      color: var(--verde-oscuro);
    }

    h3 {
      font-size: 15px;
      margin: 16px 0 6px;
      color: var(--verde);
    }

    p {
      font-size: 14px;
      line-height: 1.55;
      margin: 4px 0 8px;
    }

    ul.lista-opciones {
      margin: 6px 0 10px;
      padding-left: 18px;
      font-size: 13px;
    }

    .lista-opciones li { margin-bottom: 4px; }
    .etiqueta-opcion { font-weight: 600; color: var(--verde-oscuro); }

    .tarjeta {
      background: white;
      border-radius: 16px;
      border: 1px solid var(--gris-claro);
      box-shadow: 0 10px 30px rgba(0,0,0,0.04);
      padding: 18px 18px 20px;
    }

    .tarjeta-header {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      margin-bottom: 10px;
    }

    .tarjeta-titulo {
      font-weight: 600;
      font-size: 15px;
      color: var(--verde-oscuro);
    }

    .tarjeta-etiqueta {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--verde-claro);
      background: var(--verde-claro);
      color: var(--verde-oscuro);
    }

    .calculadora-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 4px;
    }

    label {
      font-size: 13px;
      font-weight: 500;
      display: block;
      margin-bottom: 4px;
    }

    .descripcion-label {
      font-size: 12px;
      font-weight: 400;
      opacity: 0.8;
      margin-top: 2px;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #c8d2cb;
      font-size: 13px;
      outline: none;
      background: #fbfdfb;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: var(--verde);
      box-shadow: 0 0 0 2px rgba(31,122,77,0.18);
      background: #ffffff;
    }

    .fila-dos-columnas {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    @media (max-width: 640px) {
      .fila-dos-columnas { grid-template-columns: 1fr; }
    }

    .slider-row {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1fr);
      gap: 10px;
      align-items: center;
    }

    input[type="range"] {
      width: 100%;
    }

    button {
      margin-top: 6px;
      width: 100%;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--verde), #27a063);
      color: white;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(0,0,0,0.16);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }

    button:hover {
      filter: brightness(1.03);
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    }

    .btn-secundario {
      background: #eef4f0;
      color: var(--verde-oscuro);
      box-shadow: none;
      border: 1px solid #d1ddd3;
      font-weight: 500;
    }

    .btn-secundario:hover {
      filter: none;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    .resultado {
      margin-top: 18px;
      border-radius: 12px;
      background: var(--crema);
      border: 1px solid #eadfca;
      padding: 12px 12px 10px;
      font-size: 13px;
    }

    .resultado-titulo {
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--verde-oscuro);
    }

    .resultado-monto {
      font-size: 18px;
      font-weight: 700;
      margin: 4px 0 6px;
    }

    .resultado-detalle {
      font-size: 12px;
      line-height: 1.5;
      opacity: 0.9;
    }

    .error {
      margin-top: 10px;
      font-size: 12px;
      color: var(--rojo);
    }

    table.comparativa {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 12px;
    }

    table.comparativa th,
    table.comparativa td {
      border: 1px solid #e0e4df;
      padding: 6px 8px;
      text-align: left;
    }

    table.comparativa th {
      background: #f2f6f3;
      color: var(--verde-oscuro);
      font-weight: 600;
    }

    table.comparativa td:nth-child(1) {
      font-weight: 600;
    }

    .chart-container {
      margin-top: 14px;
    }

    .chart-container canvas {
      width: 100%;
      max-height: 230px;
    }

    details {
      margin-top: 8px;
      font-size: 13px;
      background: #f4f7f5;
      border-radius: 10px;
      padding: 8px 10px;
      border: 1px solid #dde4df;
    }

    details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--verde-oscuro);
      list-style: none;
    }

    details summary::-webkit-details-marker { display: none; }

    footer {
      border-top: 1px solid #e0e4df;
      padding-top: 12px;
      margin-top: 26px;
      font-size: 11px;
      color: #888;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: space-between;
    }

    .footer-enfasis {
      font-weight: 600;
      color: var(--verde);
    }

    /* Estilos para impresi√≥n (guardar en PDF) */
    @media print {
      header, .layout-principal > div:first-child, footer {
        display: none !important;
      }
      body {
        background: white;
      }
      .contenedor {
        max-width: 100%;
        padding: 0 12px;
      }
      .layout-principal {
        display: block;
      }
      .tarjeta {
        box-shadow: none;
        border: 1px solid #cccccc;
      }
      button {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="contenedor">
      <div class="header-top">
        <div class="logo-circulo">
          CO‚ÇÇ
        </div>
        <div>
          <div class="badge">
            <span class="badge-dot"></span>
            <span>Proyecto de Aula ¬∑ Ingenier√≠a Econ√≥mica</span>
          </div>
          <h1>Calculadora de inversi√≥n en bonos de carbono</h1>
          <p class="subtitulo">
            Herramienta acad√©mica para estimar la inversi√≥n inicial necesaria para que una empresa
            compense sus emisiones anuales de CO‚ÇÇ mediante la compra de bonos de carbono vinculados
            a actividades de protecci√≥n, cuidado y restauraci√≥n de coberturas vegetales en Colombia.
          </p>
          <p class="subtitulo subtitulo-sec">
            Universidad Santo Tom√°s ‚Äì Sede Tunja<br>
            Programa de Ingenier√≠a Ambiental ¬∑ Asignatura: Ingenier√≠a Econ√≥mica<br>
            Elaborado por: Juan Manuel Becerra Ayala y Mariana Catalina Espinel Rocha.
          </p>
          <div class="chip-list">
            <span class="chip">Compensaci√≥n de emisiones</span>
            <span class="chip">Parques y zonas de amortiguaci√≥n</span>
            <span class="chip">Chiribiquete y Amazon√≠a</span>
            <span class="chip">An√°lisis econ√≥mico-ambiental</span>
          </div>
        </div>
      </div>

      <div class="header-grid">
        <div>
          <h3 style="color:#ddf6e7; margin-top:18px;">üåé ¬øQu√© hace esta herramienta?</h3>
          <p class="subtitulo">
            A partir de las emisiones de la empresa, el precio base del bono (5 USD/tCO‚ÇÇ) y el tipo de
            proyecto ambiental seleccionado, la calculadora estima el valor de la inversi√≥n en pesos
            colombianos (COP) para compensar un a√±o de emisiones.
          </p>
        </div>
        <div class="resumen-card">
          <div class="resumen-item">
            <span class="resumen-label">Enfoque</span>
            <span class="resumen-valor">Ingenier√≠a Econ√≥mica &amp; Ambiental</span>
          </div>
          <div class="resumen-item">
            <span class="resumen-label">Precio base de referencia</span>
            <span class="resumen-valor">5 USD / tCO‚ÇÇ</span>
          </div>
          <div class="resumen-item">
            <span class="resumen-label">Tipo de proyectos</span>
            <span class="resumen-valor">Protecci√≥n, mantenimiento y restauraci√≥n</span>
          </div>
          <div class="resumen-item">
            <span class="resumen-label">√Åreas potenciales</span>
            <span class="resumen-valor">Zonas de amortiguaci√≥n ¬∑ Chiribiquete</span>
          </div>
          <span class="pill">Uso acad√©mico ‚Äì No es una cotizaci√≥n comercial real</span>
        </div>
      </div>

      <!-- Banner con la imagen generada -->
      <div class="hero-banner">
        <img src="20251124_2314_Bosque Amaz√≥nico Tranquilo_simple_compose_01kawkdbqzf7yrn91gs50b3ct2.png"
             alt="Bosque amaz√≥nico tranquilo con tonos verdes profundos y niebla suave" />
      </div>
    </div>
  </header>

  <main class="contenedor">
    <div class="layout-principal">
      <!-- COLUMNA IZQUIERDA: CONTEXTO + ESTIMADOR -->
      <div>
        <section>
          <h2>üåø Contexto: bonos de carbono y realidad ambiental en Colombia</h2>
          <p>
            Los bonos de carbono representan la reducci√≥n o captura de una tonelada de CO‚ÇÇ equivalente
            (tCO‚ÇÇe). En Colombia, su uso se ha impulsado por los compromisos clim√°ticos internacionales,
            el impuesto al carbono y la necesidad de financiar la protecci√≥n de ecosistemas estrat√©gicos
            como la Amazon√≠a y los parques nacionales naturales.
          </p>
          <p>
            Zonas como la Serran√≠a de Chiribiquete y sus √°reas de amortiguaci√≥n son clave para almacenar
            carbono, conservar biodiversidad y reducir la deforestaci√≥n. A trav√©s de esquemas de
            compensaci√≥n, las empresas pueden financiar:
          </p>
          <ul class="lista-opciones">
            <li><span class="etiqueta-opcion">üõ°Ô∏è Protecci√≥n:</span> presencia de guardabosques y control de actividades ilegales.</li>
            <li><span class="etiqueta-opcion">üå± Mantenimiento:</span> cuidado de coberturas vegetales, abonos y manejo de suelos.</li>
            <li><span class="etiqueta-opcion">üå≥ Restauraci√≥n activa:</span> siembra de √°rboles nativos y recuperaci√≥n de √°reas degradadas.</li>
          </ul>
          <p>
            Desde la perspectiva de Ingenier√≠a Econ√≥mica, esta herramienta facilita la
            <strong>estimaci√≥n de la inversi√≥n inicial</strong> necesaria para compensar emisiones, apoyada
            en principios de an√°lisis de costos, evaluaci√≥n de alternativas y costo de actividades
            ambientales.
          </p>

          <details>
            <summary>üìò Marco te√≥rico de Ingenier√≠a Econ√≥mica (resumen)</summary>
            <p style="margin-top:6px;">
              El modelo utiliza:
            </p>
            <ul class="lista-opciones">
              <li><strong>Costos basados en actividades (ABC):</strong> cada opci√≥n de bono incorpora actividades adicionales (protecci√≥n, mantenimiento, restauraci√≥n) que se representan con multiplicadores sobre el costo base.</li>
              <li><strong>Evaluaci√≥n de alternativas:</strong> la empresa puede comparar tres niveles de intensidad ambiental con distintos costos de compensaci√≥n.</li>
              <li><strong>Inversi√≥n inicial:</strong> el c√°lculo se centra en el desembolso requerido para compensar un a√±o de emisiones, sin modelar flujos futuros.</li>
            </ul>
          </details>
        </section>

        <section>
          <h2>üìä Opciones de bonos modeladas en la calculadora</h2>
          <p>La calculadora ofrece tres niveles de intensidad de intervenci√≥n ambiental:</p>

          <h3>1Ô∏è‚É£ Opci√≥n 1 ‚Äì Bono simple: protecci√≥n b√°sica</h3>
          <p>
            Incluye acciones de vigilancia y presencia de guardabosques en zonas protegidas. Es la opci√≥n
            de menor costo relativo, representada en el modelo con un multiplicador de <strong>1,0</strong>
            sobre el precio base.
          </p>

          <h3>2Ô∏è‚É£ Opci√≥n 2 ‚Äì Protecci√≥n + cuidado de coberturas vegetales</h3>
          <p>
            Adem√°s de guardabosques, incorpora jornadas de cuidado de la cobertura vegetal, uso de abonos
            y fertilizaci√≥n ecol√≥gica. Se modela con un multiplicador de <strong>1,2</strong>, reflejando
            mayores costos asociados a las actividades adicionales.
          </p>

          <h3>3Ô∏è‚É£ Opci√≥n 3 ‚Äì Protecci√≥n + cuidado + siembra de √°rboles nativos</h3>
          <p>
            Incluye protecci√≥n, mantenimiento y jornadas de siembra y restauraci√≥n con especies nativas en
            zonas de recuperaci√≥n o amortiguaci√≥n. Se modela con un multiplicador de
            <strong>1,5</strong>, por ser la opci√≥n de mayor intensidad y costo, pero tambi√©n con
            mayor impacto ambiental.
          </p>

          <table class="comparativa">
            <thead>
              <tr>
                <th>Opci√≥n</th>
                <th>Multiplicador</th>
                <th>Actividades principales</th>
                <th>Costo estimado (COP)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Opci√≥n 1</td>
                <td>1,0</td>
                <td>Guardabosques y protecci√≥n b√°sica.</td>
                <td id="costo-op1">‚Äî</td>
              </tr>
              <tr>
                <td>Opci√≥n 2</td>
                <td>1,2</td>
                <td>Protecci√≥n + cuidado de coberturas vegetales.</td>
                <td id="costo-op2">‚Äî</td>
              </tr>
              <tr>
                <td>Opci√≥n 3</td>
                <td>1,5</td>
                <td>Protecci√≥n + cuidado + siembra de √°rboles nativos.</td>
                <td id="costo-op3">‚Äî</td>
              </tr>
            </tbody>
          </table>
        </section>

        <section class="tarjeta">
          <div class="tarjeta-header">
            <div class="tarjeta-titulo">üß™ Estimador simple de emisiones (opcional)</div>
            <div class="tarjeta-etiqueta">Apoyo para la entrada de datos</div>
          </div>
          <p style="font-size:13px;">
            Si la empresa no tiene a√∫n un inventario de emisiones detallado, se puede usar este estimador
            simplificado para obtener una <strong>aproximaci√≥n</strong> de las toneladas de CO‚ÇÇ anuales.
            Los factores usados son supuestos did√°cticos.
          </p>
          <div class="calculadora-grid">
            <div class="fila-dos-columnas">
              <div>
                <label for="kwh">Consumo anual de energ√≠a el√©ctrica (kWh)</label>
                <input type="number" id="kwh" min="0" step="1" placeholder="Ejemplo: 120000" />
                <div class="descripcion-label">
                  Supuesto: 0,0004 tCO‚ÇÇ por kWh consumido.
                </div>
              </div>
              <div>
                <label for="litros">Consumo anual de combustible (litros)</label>
                <input type="number" id="litros" min="0" step="1" placeholder="Ejemplo: 30000" />
                <div class="descripcion-label">
                  Supuesto: 0,0025 tCO‚ÇÇ por litro de combustible.
                </div>
              </div>
            </div>
            <button type="button" class="btn-secundario" onclick="estimarEmisiones()">
              Estimar emisiones y enviar a la calculadora
            </button>
            <div id="estimador-resultado" class="descripcion-label"></div>
          </div>
        </section>
      </div>

      <!-- COLUMNA DERECHA: CALCULADORA + GR√ÅFICO -->
      <div id="panel-reporte">
        <section class="tarjeta">
          <div class="tarjeta-header">
            <div class="tarjeta-titulo">üßÆ Calculadora de inversi√≥n inicial</div>
            <div class="tarjeta-etiqueta">Simulaci√≥n acad√©mica</div>
          </div>
          <p style="font-size:13px; margin-bottom:10px;">
            Ingresa los datos de tu empresa para estimar cu√°nto deber√≠a invertir en bonos de carbono
            para compensar sus emisiones anuales de CO‚ÇÇ.
          </p>

          <div class="calculadora-grid">
            <div>
              <label for="emisiones">
                Emisiones anuales (toneladas de CO‚ÇÇ)
              </label>
              <div class="slider-row">
                <input type="range" id="emisiones-slider" min="0" max="50000" step="10" value="0" />
                <input type="number" id="emisiones" step="0.01" min="0" placeholder="Ejemplo: 1 250" />
              </div>
              <div class="descripcion-label">
                Puedes ajustar con el deslizador o escribir el valor. Corresponde a la huella anual que la empresa desea compensar.
              </div>
            </div>

            <div class="fila-dos-columnas">
              <div>
                <label for="tasa">
                  Tasa de cambio COP / USD
                </label>
                <input type="number" id="tasa" step="1" min="0" placeholder="Ejemplo: 4200" />
                <div class="descripcion-label" id="trm-info">
                  Valor del d√≥lar usado en el c√°lculo (TRM aproximada).
                </div>
                <button type="button" class="btn-secundario" style="margin-top:6px;" onclick="obtenerTRM()">
                  Usar TRM actual (aprox.)
                </button>
              </div>
              <div>
                <label for="precio">
                  Precio base del bono (USD / tCO‚ÇÇ)
                </label>
                <input type="number" id="precio" step="0.01" min="0" value="5" />
                <div class="descripcion-label">
                  Para este proyecto se toma como referencia 5 USD por tonelada de CO‚ÇÇ.
                </div>
              </div>
            </div>

            <div>
              <label for="opcion">
                Tipo de bono / intensidad de intervenci√≥n
              </label>
              <select id="opcion">
                <option value="1">Opci√≥n 1 ‚Äì Guardabosques (protecci√≥n b√°sica)</option>
                <option value="2">Opci√≥n 2 ‚Äì Protecci√≥n + cuidado de coberturas</option>
                <option value="3">Opci√≥n 3 ‚Äì Protecci√≥n + cuidado + siembra de √°rboles</option>
              </select>
              <div class="descripcion-label">
                La opci√≥n elegida ajusta el precio final del bono seg√∫n las actividades ambientales.
              </div>
            </div>

            <button type="button" onclick="calcular()">Calcular inversi√≥n en COP</button>
            <button type="button" class="btn-secundario" onclick="window.print()">
              Imprimir / guardar reporte en PDF
            </button>

            <div id="mensaje-error" class="error" style="display:none;"></div>

            <div class="resultado" id="resultado" style="display:none;">
              <div class="resultado-titulo">Resultado de la simulaci√≥n</div>
              <div class="resultado-monto" id="resultado-monto"></div>
              <div class="resultado-detalle" id="resultado-detalle"></div>
            </div>
          </div>
        </section>

        <section class="tarjeta" style="margin-top:16px;">
          <div class="tarjeta-header">
            <div class="tarjeta-titulo">üìà Comparaci√≥n econ√≥mica de opciones</div>
            <div class="tarjeta-etiqueta">Mismo nivel de emisiones</div>
          </div>
          <p style="font-size:13px;">
            A partir de las mismas emisiones, la misma tasa de cambio y el precio base seleccionado, se
            compara el costo de compensaci√≥n para las tres opciones de intensidad de intervenci√≥n ambiental.
          </p>

          <div class="chart-container">
            <canvas id="chartCostos"></canvas>
          </div>

          <p id="texto-escenario-social" class="descripcion-label" style="margin-top:10px;"></p>
        </section>

        <footer>
          <div>
            <span class="footer-enfasis">Nota:</span>
            la herramienta usa supuestos simplificados para fines acad√©micos de Ingenier√≠a Econ√≥mica.
          </div>
          <div>
            No reemplaza estudios t√©cnicos, inventarios de carbono ni cotizaciones de proyectos reales.
          </div>
          <div>
            Desarrollado por: Juan Manuel Becerra Ayala y Mariana Catalina Espinel Rocha ‚Äì Universidad Santo Tom√°s, Tunja.
          </div>
        </footer>
      </div>
    </div>
  </main>

  <script>
    let chartCostos = null;

    function formatoNumeroCOP(valor) {
      return valor.toLocaleString("es-CO", {
        style: "currency",
        currency: "COP",
        maximumFractionDigits: 0
      });
    }

    function formatoNumeroUSD(valor) {
      return valor.toLocaleString("es-CO", {
        style: "currency",
        currency: "USD",
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function obtenerMultiplicadorYOpcion(O) {
      let M = 1.0;
      let descripcion = "";

      if (O === 1) {
        M = 1.0;
        descripcion = "Opci√≥n 1 ‚Äì Guardabosques (protecci√≥n b√°sica).";
      } else if (O === 2) {
        M = 1.2;
        descripcion =
          "Opci√≥n 2 ‚Äì Protecci√≥n con guardabosques + jornadas de cuidado de coberturas vegetales.";
      } else if (O === 3) {
        M = 1.5;
        descripcion =
          "Opci√≥n 3 ‚Äì Protecci√≥n, cuidado de coberturas y jornadas de siembra de √°rboles nativos.";
      }
      return { M, descripcion };
    }

    async function obtenerTRM() {
      const tasaInput = document.getElementById("tasa");
      const trmInfo = document.getElementById("trm-info");
    
      trmInfo.textContent = "Consultando TRM actual aproximada...";
    
      try {
        // Nueva API: open.er-api.com (sin API key, CORS habilitado)
        const respuesta = await fetch("https://open.er-api.com/v6/latest/USD");
    
        if (!respuesta.ok) {
          throw new Error("No se pudo obtener la TRM");
        }
    
        const datos = await respuesta.json();
        // La estructura de la respuesta es: { result: "success", base_code: "USD", rates: { COP: 3xxx.xx, ... } }
        const tasa = datos && datos.rates && datos.rates.COP ? datos.rates.COP : null;
    
        if (!tasa) {
          throw new Error("Respuesta inv√°lida de la API");
        }
    
        const tasaRedondeada = Math.round(tasa);
        tasaInput.value = tasaRedondeada;
    
        trmInfo.innerHTML =
          `TRM aproximada obtenida en l√≠nea: <strong>${tasaRedondeada.toLocaleString("es-CO")} COP / USD</strong>. ` +
          `Puedes ajustarla manualmente si lo consideras necesario.`;
      } catch (error) {
        console.error(error);
        trmInfo.textContent =
          "No fue posible obtener la TRM actual autom√°ticamente. Ingresa la tasa manualmente.";
      }
    }


    function calcular() {
      const emisionesInput = document.getElementById("emisiones");
      const tasaInput = document.getElementById("tasa");
      const precioInput = document.getElementById("precio");
      const opcionSelect = document.getElementById("opcion");
      const slider = document.getElementById("emisiones-slider");

      const E = parseFloat(emisionesInput.value);
      const T = parseFloat(tasaInput.value);
      const P = parseFloat(precioInput.value);
      const O = parseInt(opcionSelect.value, 10);

      const errorDiv = document.getElementById("mensaje-error");
      const resultadoDiv = document.getElementById("resultado");
      const resultadoMonto = document.getElementById("resultado-monto");
      const resultadoDetalle = document.getElementById("resultado-detalle");

      errorDiv.style.display = "none";
      resultadoDiv.style.display = "none";
      errorDiv.textContent = "";
      resultadoMonto.textContent = "";
      resultadoDetalle.textContent = "";

      if (isNaN(E) || isNaN(T) || isNaN(P) || E <= 0 || T <= 0 || P <= 0) {
        errorDiv.textContent =
          "Por favor ingresa valores num√©ricos v√°lidos y mayores que cero en todos los campos.";
        errorDiv.style.display = "block";
        return;
      }

      // Sincronizar slider con el valor ingresado
      if (!isNaN(E)) {
        const maxSlider = parseFloat(slider.max);
        slider.value = Math.min(E, maxSlider);
      }

      const { M, descripcion } = obtenerMultiplicadorYOpcion(O);

      const precioFinalBono = P * M;       // USD / tCO2
      const costoUSD = E * precioFinalBono;
      const costoCOP = costoUSD * T;

      resultadoDiv.style.display = "block";
      resultadoMonto.textContent = formatoNumeroCOP(costoCOP);

      const detalleHTML = `
        Para compensar <strong>${E.toLocaleString("es-CO", {maximumFractionDigits: 2})} toneladas de CO‚ÇÇ</strong>,
        con un precio base de <strong>${formatoNumeroUSD(P)} por tCO‚ÇÇ</strong> y la
        ${descripcion}<br><br>
        ‚Ä¢ Precio final del bono: <strong>${formatoNumeroUSD(precioFinalBono)} por tCO‚ÇÇ</strong>.<br>
        ‚Ä¢ Costo total en d√≥lares: <strong>${formatoNumeroUSD(costoUSD)}</strong>.<br>
        ‚Ä¢ Tasa de cambio usada: <strong>${T.toLocaleString("es-CO")} COP / USD</strong>.<br><br>
        La inversi√≥n inicial estimada que deber√≠a realizar la empresa para compensar sus emisiones de
        un a√±o es de <strong>${formatoNumeroCOP(costoCOP)}</strong>.
      `;

      resultadoDetalle.innerHTML = detalleHTML;

      // Actualizar tabla comparativa y gr√°fico
      actualizarComparacion(E, T, P);
    }

    function actualizarComparacion(E, T, P) {
      const multiplicadores = {
        1: 1.0,
        2: 1.2,
        3: 1.5
      };

      const costosCOP = [1,2,3].map(op => {
        const M = multiplicadores[op];
        return E * P * M * T;
      });

      // Actualizar tabla
      document.getElementById("costo-op1").textContent =
        E > 0 ? formatoNumeroCOP(costosCOP[0]) : "‚Äî";
      document.getElementById("costo-op2").textContent =
        E > 0 ? formatoNumeroCOP(costosCOP[1]) : "‚Äî";
      document.getElementById("costo-op3").textContent =
        E > 0 ? formatoNumeroCOP(costosCOP[2]) : "‚Äî";

      // Escenario alterno de precio social (ejemplo 50 USD/tCO2)
      const precioSocial = 50;
      const costosSocial = [1,2,3].map(op => {
        const M = multiplicadores[op];
        return E * precioSocial * M * T;
      });

      const textoSocial = document.getElementById("texto-escenario-social");
      if (E > 0 && T > 0) {
        textoSocial.innerHTML =
          `Si en lugar de un precio base de <strong>${formatoNumeroUSD(P)}</strong> se usara un ` +
          `precio social del carbono de <strong>${formatoNumeroUSD(precioSocial)}</strong> por tCO‚ÇÇ, ` +
          `los costos de compensaci√≥n ser√≠an aproximadamente:<br>` +
          `‚Ä¢ Opci√≥n 1: ${formatoNumeroCOP(costosSocial[0])}. ` +
          `‚Ä¢ Opci√≥n 2: ${formatoNumeroCOP(costosSocial[1])}. ` +
          `‚Ä¢ Opci√≥n 3: ${formatoNumeroCOP(costosSocial[2])}.`;
      } else {
        textoSocial.textContent = "";
      }

      // Actualizar gr√°fico
      actualizarGrafico(costosCOP);
    }

    function actualizarGrafico(costosCOP) {
      const ctx = document.getElementById("chartCostos");
      const data = {
        labels: ["Opci√≥n 1", "Opci√≥n 2", "Opci√≥n 3"],
        datasets: [{
          label: "Costo de compensaci√≥n (COP)",
          data: costosCOP,
          borderWidth: 1
        }]
      };

      const options = {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return (value / 1000000).toFixed(1) + " M";
              }
            },
            title: {
              display: true,
              text: "Millones de COP"
            }
          }
        },
        plugins: {
          legend: {
            display: false
          }
        }
      };

      if (chartCostos) {
        chartCostos.data = data;
        chartCostos.options = options;
        chartCostos.update();
      } else {
        chartCostos = new Chart(ctx, {
          type: "bar",
          data,
          options
        });
      }
    }

    function estimarEmisiones() {
      const kwh = parseFloat(document.getElementById("kwh").value);
      const litros = parseFloat(document.getElementById("litros").value);
      const divResultado = document.getElementById("estimador-resultado");
      const emisionesInput = document.getElementById("emisiones");
      const slider = document.getElementById("emisiones-slider");

      let E = 0;
      if (!isNaN(kwh) && kwh > 0) {
        E += kwh * 0.0004;
      }
      if (!isNaN(litros) && litros > 0) {
        E += litros * 0.0025;
      }

      if (E <= 0) {
        divResultado.textContent =
          "Ingresa al menos un valor de consumo para estimar las emisiones.";
        return;
      }

      divResultado.innerHTML =
        `Estimaci√≥n aproximada: <strong>${E.toFixed(2)} tCO‚ÇÇ/a√±o</strong>. ` +
        `Este valor se ha enviado a la calculadora principal.`;

      emisionesInput.value = E.toFixed(2);
      const maxSlider = parseFloat(slider.max);
      slider.value = Math.min(E, maxSlider);
    }

    // Sincronizar slider y campo num√©rico al cargar
    window.addEventListener("DOMContentLoaded", () => {
      const slider = document.getElementById("emisiones-slider");
      const emisionesInput = document.getElementById("emisiones");

      slider.addEventListener("input", () => {
        emisionesInput.value = slider.value;
      });

      emisionesInput.addEventListener("input", () => {
        const val = parseFloat(emisionesInput.value);
        if (!isNaN(val)) {
          const maxSlider = parseFloat(slider.max);
          slider.value = Math.min(val, maxSlider);
        }
      });
    });
  </script>
</body>
</html>
